import { __decorate, __param } from "tslib";
import { forwardRef, Inject, Directive, ElementRef, OnInit, OnDestroy, Host, Self, Optional, Renderer2, Input, AfterViewInit } from '@angular/core';
import { AnimationMetadata, AnimationBuilder } from '@angular/animations';
import { MatSidenav, MatDrawer, MatSidenavContainer, MatDrawerContainer } from '@angular/material/sidenav';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { miniConfig } from './default.config';
import { sidebarAnimationCloseGroup, sidebarAnimationOpenGroup } from './animations.settings';
import { Directionality } from '@angular/cdk/bidi';
var MatDrawerRailDirective = /** @class */ (function () {
    function MatDrawerRailDirective(builder, el, renderer2, sidenav, drawer, matSideNavContainer, matDrawerContainer, 
    // tslint:disable-next-line: variable-name
    _dir) {
        this.builder = builder;
        this.el = el;
        this.renderer2 = renderer2;
        this._dir = _dir;
        this.onDestory = new Subject();
        this.closeWidth = miniConfig.defaultMinWidth;
        this.expandedWidth = miniConfig.defaultMaxWidth;
        this.container = matSideNavContainer || matDrawerContainer;
        this.drawer = sidenav || drawer;
        this.container.hasBackdrop = false;
        this.drawer.autoFocus = false;
    }
    MatDrawerRailDirective.prototype.ngOnInit = function () {
        var _this = this;
        this.closeAnimation = this.closeAnimation || sidebarAnimationCloseGroup(miniConfig.defaultDuration, this.closeWidth);
        this.openAnimation = this.openAnimation || sidebarAnimationOpenGroup(miniConfig.defaultDuration, this.expandedWidth);
        this.renderer2.setStyle(this.el.nativeElement.querySelector('.mat-drawer-inner-container'), 'overflow', 'hidden');
        this.drawer.closedStart.pipe(takeUntil(this.onDestory)).subscribe(function () {
            _this.closeMenu();
        });
        this.drawer._closedStream.pipe(takeUntil(this.onDestory)).subscribe(function () {
            _this.renderer2.setStyle(_this.el.nativeElement, 'visibility', 'visible');
        });
        this.drawer.openedStart.pipe(takeUntil(this.onDestory)).subscribe(function () {
            _this.correctContentMargin(_this.expandedWidth);
            var factory = _this.builder.build(_this.openAnimation);
            var player = factory.create(_this.el.nativeElement);
            player.play();
        });
    };
    MatDrawerRailDirective.prototype.ngAfterViewInit = function () {
        if (this.drawer.opened) {
            this.correctContentMargin(this.expandedWidth);
        }
        else {
            this.renderer2.setStyle(this.el.nativeElement, 'visibility', 'visible');
            this.closeMenu();
        }
    };
    MatDrawerRailDirective.prototype.closeMenu = function () {
        this.correctContentMargin(this.closeWidth);
        var factory = this.builder.build(this.closeAnimation);
        var player = factory.create(this.el.nativeElement);
        player.play();
    };
    MatDrawerRailDirective.prototype.correctContentMargin = function (width) {
        this.containerContent = this.containerContent ? this.containerContent : this.el.nativeElement.parentElement.querySelector('.mat-drawer-content');
        if ((this.drawer.position !== 'end' && this._dir && this._dir.value !== 'rtl')
            || (this.drawer.position === 'end' && this._dir && this._dir.value === 'rtl')) {
            this.renderer2.setStyle(this.containerContent, 'marginLeft', width);
        }
        else {
            this.renderer2.setStyle(this.containerContent, 'marginRight', width);
        }
    };
    MatDrawerRailDirective.prototype.ngOnDestroy = function () {
        this.onDestory.next();
        this.onDestory.complete();
    };
    MatDrawerRailDirective.ctorParameters = function () { return [
        { type: AnimationBuilder },
        { type: ElementRef },
        { type: Renderer2 },
        { type: MatSidenav, decorators: [{ type: Host }, { type: Self }, { type: Optional }] },
        { type: MatDrawer, decorators: [{ type: Host }, { type: Self }, { type: Optional }] },
        { type: MatSidenavContainer, decorators: [{ type: Inject, args: [forwardRef(function () { return MatSidenavContainer; }),] }, { type: Optional }] },
        { type: MatDrawerContainer, decorators: [{ type: Inject, args: [forwardRef(function () { return MatDrawerContainer; }),] }, { type: Optional }] },
        { type: Directionality, decorators: [{ type: Optional }] }
    ]; };
    __decorate([
        Input()
    ], MatDrawerRailDirective.prototype, "openAnimation", void 0);
    __decorate([
        Input()
    ], MatDrawerRailDirective.prototype, "closeAnimation", void 0);
    __decorate([
        Input()
    ], MatDrawerRailDirective.prototype, "closeWidth", void 0);
    __decorate([
        Input()
    ], MatDrawerRailDirective.prototype, "expandedWidth", void 0);
    MatDrawerRailDirective = __decorate([
        Directive({
            // tslint:disable-next-line: directive-selector
            selector: 'mat-sidenav[mode="rail"], mat-drawer[mode="rail"]',
            // tslint:disable-next-line: no-host-metadata-property
            host: {
                '[class.mat-drawer-side]': 'true',
            }
        }),
        __param(3, Host()), __param(3, Self()), __param(3, Optional()),
        __param(4, Host()), __param(4, Self()), __param(4, Optional()),
        __param(5, Inject(forwardRef(function () { return MatSidenavContainer; }))), __param(5, Optional()),
        __param(6, Inject(forwardRef(function () { return MatDrawerContainer; }))), __param(6, Optional()),
        __param(7, Optional())
    ], MatDrawerRailDirective);
    return MatDrawerRailDirective;
}());
export { MatDrawerRailDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhd2VyLXJhaWwuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1tYXRlcmlhbC1yYWlsLWRyYXdlci8iLCJzb3VyY2VzIjpbImxpYi9kcmF3ZXItcmFpbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwSixPQUFPLEVBQUUsaUJBQWlCLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUUxRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxtQkFBbUIsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRTNHLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsMEJBQTBCLEVBQUUseUJBQXlCLEVBQUcsTUFBTSx1QkFBdUIsQ0FBQztBQUMvRixPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sbUJBQW1CLENBQUM7QUFXakQ7SUFxQkUsZ0NBQ1UsT0FBeUIsRUFDekIsRUFBMkIsRUFDM0IsU0FBb0IsRUFDQSxPQUFtQixFQUNuQixNQUFpQixFQUNjLG1CQUF3QyxFQUN6QyxrQkFBc0M7SUFDaEcsMENBQTBDO0lBQ3RCLElBQW9CO1FBUmhDLFlBQU8sR0FBUCxPQUFPLENBQWtCO1FBQ3pCLE9BQUUsR0FBRixFQUFFLENBQXlCO1FBQzNCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFNUixTQUFJLEdBQUosSUFBSSxDQUFn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LEFBeEZELElBd0ZDO1NBeEZZLHNCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZvcndhcmRSZWYsIEluamVjdCwgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBPbkluaXQsIE9uRGVzdHJveSwgSG9zdCwgU2VsZiwgT3B0aW9uYWwsIFJlbmRlcmVyMiwgSW5wdXQsIEFmdGVyVmlld0luaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFuaW1hdGlvbk1ldGFkYXRhLCBBbmltYXRpb25CdWlsZGVyIH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5cbmltcG9ydCB7IE1hdFNpZGVuYXYsIE1hdERyYXdlciwgTWF0U2lkZW5hdkNvbnRhaW5lciwgTWF0RHJhd2VyQ29udGFpbmVyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc2lkZW5hdic7XG5cbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgbWluaUNvbmZpZyB9IGZyb20gJy4vZGVmYXVsdC5jb25maWcnO1xuaW1wb3J0IHsgc2lkZWJhckFuaW1hdGlvbkNsb3NlR3JvdXAsIHNpZGViYXJBbmltYXRpb25PcGVuR3JvdXAgIH0gZnJvbSAnLi9hbmltYXRpb25zLnNldHRpbmdzJztcbmltcG9ydCB7RGlyZWN0aW9uYWxpdHl9IGZyb20gJ0Bhbmd1bGFyL2Nkay9iaWRpJztcbmltcG9ydCB7IGluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvdGVzdGluZyc7XG5cbkBEaXJlY3RpdmUoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IGRpcmVjdGl2ZS1zZWxlY3RvclxuICBzZWxlY3RvcjogJ21hdC1zaWRlbmF2W21vZGU9XCJyYWlsXCJdLCBtYXQtZHJhd2VyW21vZGU9XCJyYWlsXCJdJyxcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby1ob3N0LW1ldGFkYXRhLXByb3BlcnR5XG4gIGhvc3Q6IHtcbiAgICAnW2NsYXNzLm1hdC1kcmF3ZXItc2lkZV0nOiAndHJ1ZScsXG4gIH1cbn0pXG5leHBvcnQgY2xhc3MgTWF0RHJhd2VyUmFpbERpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0IHtcblxuICBwdWJsaWMgb25EZXN0b3J5OiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcblxuICBwcml2YXRlIGRyYXdlcjogTWF0U2lkZW5hdiB8IE1hdERyYXdlcjtcbiAgcHJpdmF0ZSBjb250YWluZXI6IE1hdFNpZGVuYXZDb250YWluZXIgfCBNYXREcmF3ZXJDb250YWluZXI7XG5cbiAgcHJpdmF0ZSBjb250YWluZXJDb250ZW50OiBIVE1MRWxlbWVudDtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgb3BlbkFuaW1hdGlvbjogQW5pbWF0aW9uTWV0YWRhdGEgfCBBbmltYXRpb25NZXRhZGF0YVtdO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBjbG9zZUFuaW1hdGlvbjogQW5pbWF0aW9uTWV0YWRhdGEgfCBBbmltYXRpb25NZXRhZGF0YVtdO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBjbG9zZVdpZHRoOiBzdHJpbmcgPSBtaW5pQ29uZmlnLmRlZmF1bHRNaW5XaWR0aDtcblxuICBASW5wdXQoKVxuICBwdWJsaWMgZXhwYW5kZWRXaWR0aDogc3RyaW5nID0gbWluaUNvbmZpZy5kZWZhdWx0TWF4V2lkdGg7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBidWlsZGVyOiBBbmltYXRpb25CdWlsZGVyLFxuICAgIHByaXZhdGUgZWw6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+LFxuICAgIHByaXZhdGUgcmVuZGVyZXIyOiBSZW5kZXJlcjIsXG4gICAgQEhvc3QoKSBAU2VsZigpIEBPcHRpb25hbCgpIHNpZGVuYXY6IE1hdFNpZGVuYXYsXG4gICAgQEhvc3QoKSBAU2VsZigpIEBPcHRpb25hbCgpIGRyYXdlcjogTWF0RHJhd2VyLFxuICAgIEBJbmplY3QoZm9yd2FyZFJlZigoKSA9PiBNYXRTaWRlbmF2Q29udGFpbmVyKSkgQE9wdGlvbmFsKCkgbWF0U2lkZU5hdkNvbnRhaW5lcjogTWF0U2lkZW5hdkNvbnRhaW5lcixcbiAgICBASW5qZWN0KGZvcndhcmRSZWYoKCkgPT4gTWF0RHJhd2VyQ29udGFpbmVyKSkgQE9wdGlvbmFsKCkgbWF0RHJhd2VyQ29udGFpbmVyOiBNYXREcmF3ZXJDb250YWluZXIsXG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiB2YXJpYWJsZS1uYW1lXG4gICAgQE9wdGlvbmFsKCkgcHJpdmF0ZSBfZGlyOiBEaXJlY3Rpb25hbGl0eSxcbiAgKSB7XG4gICAgdGhpcy5jb250YWluZXIgPSBtYXRTaWRlTmF2Q29udGFpbmVyIHx8IG1hdERyYXdlckNvbnRhaW5lcjtcbiAgICB0aGlzLmRyYXdlciA9IHNpZGVuYXYgfHwgZHJhd2VyO1xuICAgIHRoaXMuY29udGFpbmVyLmhhc0JhY2tkcm9wID0gZmFsc2U7XG4gICAgdGhpcy5kcmF3ZXIuYXV0b0ZvY3VzID0gZmFsc2U7XG4gIH1cblxuICBwdWJsaWMgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5jbG9zZUFuaW1hdGlvbiA9IHRoaXMuY2xvc2VBbmltYXRpb24gfHwgc2lkZWJhckFuaW1hdGlvbkNsb3NlR3JvdXAobWluaUNvbmZpZy5kZWZhdWx0RHVyYXRpb24sIHRoaXMuY2xvc2VXaWR0aCk7XG4gICAgdGhpcy5vcGVuQW5pbWF0aW9uID0gdGhpcy5vcGVuQW5pbWF0aW9uIHx8IHNpZGViYXJBbmltYXRpb25PcGVuR3JvdXAobWluaUNvbmZpZy5kZWZhdWx0RHVyYXRpb24sIHRoaXMuZXhwYW5kZWRXaWR0aCk7XG4gICAgdGhpcy5yZW5kZXJlcjIuc2V0U3R5bGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYXQtZHJhd2VyLWlubmVyLWNvbnRhaW5lcicpLCAnb3ZlcmZsb3cnLCAnaGlkZGVuJyk7XG4gICAgdGhpcy5kcmF3ZXIuY2xvc2VkU3RhcnQucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3RvcnkpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZU1lbnUoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuZHJhd2VyLl9jbG9zZWRTdHJlYW0ucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3RvcnkpKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgdGhpcy5yZW5kZXJlcjIuc2V0U3R5bGUodGhpcy5lbC5uYXRpdmVFbGVtZW50LCAndmlzaWJpbGl0eScsICd2aXNpYmxlJyk7XG4gICAgfSk7XG5cbiAgICB0aGlzLmRyYXdlci5vcGVuZWRTdGFydC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdG9yeSkpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLmNvcnJlY3RDb250ZW50TWFyZ2luKCB0aGlzLmV4cGFuZGVkV2lkdGgpO1xuICAgICAgY29uc3QgZmFjdG9yeSA9IHRoaXMuYnVpbGRlci5idWlsZCh0aGlzLm9wZW5BbmltYXRpb24pO1xuICAgICAgY29uc3QgcGxheWVyID0gZmFjdG9yeS5jcmVhdGUodGhpcy5lbC5uYXRpdmVFbGVtZW50KTtcbiAgICAgIHBsYXllci5wbGF5KCk7XG4gICAgfSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgaWYgKHRoaXMuZHJhd2VyLm9wZW5lZCkge1xuICAgICAgdGhpcy5jb3JyZWN0Q29udGVudE1hcmdpbih0aGlzLmV4cGFuZGVkV2lkdGgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlbmRlcmVyMi5zZXRTdHlsZSh0aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKTtcbiAgICAgIHRoaXMuY2xvc2VNZW51KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjbG9zZU1lbnUoKSB7XG4gICAgdGhpcy5jb3JyZWN0Q29udGVudE1hcmdpbih0aGlzLmNsb3NlV2lkdGgpO1xuICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLmJ1aWxkZXIuYnVpbGQodGhpcy5jbG9zZUFuaW1hdGlvbik7XG4gICAgY29uc3QgcGxheWVyID0gZmFjdG9yeS5jcmVhdGUodGhpcy5lbC5uYXRpdmVFbGVtZW50KTtcbiAgICBwbGF5ZXIucGxheSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjb3JyZWN0Q29udGVudE1hcmdpbih3aWR0aDogc3RyaW5nKSB7XG4gICAgdGhpcy5jb250YWluZXJDb250ZW50ID0gdGhpcy5jb250YWluZXJDb250ZW50ID8gdGhpcy5jb250YWluZXJDb250ZW50IDogdGhpcy5lbC5uYXRpdmVFbGVtZW50LnBhcmVudEVsZW1lbnQucXVlcnlTZWxlY3RvcignLm1hdC1kcmF3ZXItY29udGVudCcpO1xuICAgIGlmICgodGhpcy5kcmF3ZXIucG9zaXRpb24gIT09ICdlbmQnICYmIHRoaXMuX2RpciAmJiB0aGlzLl9kaXIudmFsdWUgIT09ICdydGwnKVxuICAgICAgICB8fCAodGhpcy5kcmF3ZXIucG9zaXRpb24gPT09ICdlbmQnICYmIHRoaXMuX2RpciAmJiB0aGlzLl9kaXIudmFsdWUgPT09ICdydGwnKSkge1xuICAgICAgdGhpcy5yZW5kZXJlcjIuc2V0U3R5bGUodGhpcy5jb250YWluZXJDb250ZW50LCAnbWFyZ2luTGVmdCcsICB3aWR0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVuZGVyZXIyLnNldFN0eWxlKHRoaXMuY29udGFpbmVyQ29udGVudCwgJ21hcmdpblJpZ2h0JywgIHdpZHRoKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5vbkRlc3RvcnkubmV4dCgpO1xuICAgIHRoaXMub25EZXN0b3J5LmNvbXBsZXRlKCk7XG4gIH1cbn1cbiJdfQ==